<!-- <h2>Chat App</h2>
<h2 id="messages"></h2>

<input type="text" id="sampleMessage" placeholder="Type something...">
<p>Typing: <span id="typingStatus">No typing</span></p>

<button id="sendBtn">Receive</button> -->

<!DOCTYPE html>
<html lang="en">

<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f0f2f5;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
    }

    #openModalBtn {
        padding: 10px 20px;
        font-size: 16px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    #openModalBtn:hover {
        background-color: #0056b3;
    }

    /* Modal styling */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
    }

    .modal-content {
        background-color: white;
        width: 400px;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        position: relative;
    }

    .modal-content h2 {
        margin: 0;
        margin-bottom: 15px;
        font-size: 24px;
        color: #333;
    }

    .search-box {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 20px;
        margin-bottom: 15px;
        outline: none;
        font-size: 14px;
    }

    .contact-list {
        max-height: 200px;
        overflow-y: auto;
        margin-bottom: 15px;
    }

    .contact-item {
        padding: 10px;
        cursor: pointer;
        border-radius: 10px;
        transition: background-color 0.3s;
    }

    .contact-item:hover {
        background-color: #f1f1f1;
    }

    .modal-footer {
        display: flex;
        justify-content: flex-end;
    }

    .modal-footer button {
        padding: 8px 16px;
        margin-left: 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .add-btn {
        background-color: #28a745;
        color: white;
    }

    .add-btn:hover {
        background-color: #218838;
    }

    .cancel-btn {
        background-color: #dc3545;
        color: white;
    }

    .cancel-btn:hover {
        background-color: #c82333;
    }
</style>

<head>
    <meta charset="utf-8">
    <!--  This file has been downloaded from bootdey.com @bootdey on twitter -->
    <!--  All snippets are MIT license http://bootdey.com/license -->
    <title>Chat - Chat App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://netdna.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/chat.css" rel="stylesheet">

</head>
<body>
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.nicescroll/3.7.6/jquery.nicescroll.min.js"></script>
<div class="container">
<div class="row">
        <div class="col-sm-12">
            <div class="d-flex justify-content-between">
                <h3 class="me-3 mb-0">Welcome Back, <%= data.name %>!</h3>
                <a href="/auth/logout" class="btn btn-danger">Logout</a>
              </div>
            <br>
            <div class="panel panel-white border-top-green">
                <div class="panel-body chat"> 
                    <div class="row chat-wrapper">  
                        <div class="col-md-4">
                            <div class="compose-area"> 
                                <a href="javascript:void(0);" id="openModalBtn" class="btn btn-default"><i class="fa fa-edit"></i> New Chat</a>
                            </div>
                            
                            <div>
                                <div class="slimScrollDiv" style="position: relative; overflow: hidden; width: auto; height: 550px;">
                                <div class="chat-list-wrapper" style="overflow-y: auto; width: auto; height: 550px;">
                                    <ul class="chat-list">
                                        <% for(i = 0; i<= chats.length-1; i++) { %>
                                        <li class="new">
                                            <span class="avatar available">
                                                <img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt="avatar" class="img-circle">
                                            </span>
                                            <div class="body">
                                                <div class="header">
                                                    <span class="username"><%= chats[i] %></span>
                                                    <small class="timestamp text-muted">
                                                        <i class="fa fa-clock-o"></i>1 secs ago
                                                    </small>
                                                </div>
                                                <p>
                                                   Hey, have you finished up with the Ladybug project?
                                                </p>
                                            </div>
                                        </li>  
                                        <% } %>
                                        
                                        <li class="active">
                                            <span class="avatar available">
                                                <img src="https://bootdey.com/img/Content/avatar/avatar2.png" alt="avatar" class="img-circle">
                                            </span>
                                            <div class="body">
                                                <div class="header">
                                                    <span class="username">Yanique Robinson</span>
                                                    <small class="timestamp text-muted">
                                                        <i class="fa fa-clock-o"></i>3 secs ago
                                                    </small>
                                                </div>
                                                <p>
                                                    Cool. I'll see you guys then.
                                                </p>
                                            </div>
                                        </li>  
                                        <li>
                                            <span class="avatar">
                                                <img src="https://bootdey.com/img/Content/avatar/avatar3.png" alt="avatar" class="img-circle">
                                            </span>
                                            <div class="body">
                                                <div class="header">
                                                    <span class="username">Ryan Haywood</span>
                                                    <small class="timestamp text-muted">
                                                        <i class="fa fa-clock-o"></i>12 mins ago
                                                    </small>
                                                </div>
                                                <p>
                                                    Kevin, tomorrow is GoT night at my house. Bring your HDMI extension. Thanks.
                                                </p>
                                            </div>
                                        </li>
                                        <li>
                                            <span class="avatar busy">
                                                <img src="https://bootdey.com/img/Content/avatar/avatar4.png" alt="avatar" class="img-circle">
                                            </span>
                                            <div class="body">
                                                <div class="header">
                                                    <span class="username">Geoff Ramsey</span>
                                                    <small class="timestamp text-muted">
                                                        <i class="fa fa-clock-o"></i>1 hour ago
                                                    </small>
                                                </div>
                                                <p>
                                                    Sales want to see you. Something about the new product.
                                                </p>
                                            </div>
                                        </li>
                                        <li>
                                            <span class="avatar">
                                                <img src="https://bootdey.com/img/Content/avatar/avatar5.png" alt="avatar" class="img-circle">
                                            </span>
                                            <div class="body">
                                                <div class="header">
                                                    <span class="username">Kara Mendly</span>
                                                    <small class="timestamp text-muted">
                                                        <i class="fa fa-clock-o"></i>5 hours ago
                                                    </small>
                                                </div>
                                                <p>
                                                    Meeting next week Tuesday. Nothing serious, just bring teams work progress with you.
                                                </p>
                                            </div>
                                        </li> 
                                        <li>
                                            <span class="avatar busy">
                                                <img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt="avatar" class="img-circle">
                                            </span>
                                            <div class="body">
                                                <div class="header">
                                                    <span class="username">Jack Patillo</span>
                                                    <small class="timestamp text-muted">
                                                        <i class="fa fa-clock-o"></i>12 mins ago
                                                    </small>
                                                </div>
                                                <p>
                                                    hey, what does this error mean?
                                                </p>
                                            </div>
                                        </li>  
                                    </ul>
                                </div><div class="slimScrollBar" style="width: 7px; position: absolute; top: 0px; opacity: 0.4; display: none; border-radius: 7px; z-index: 99; right: 1px; height: 478.639px; background: rgb(0, 0, 0);"></div><div class="slimScrollRail" style="width: 7px; height: 100%; position: absolute; top: 0px; display: none; border-radius: 7px; opacity: 0.2; z-index: 90; right: 1px; background: rgb(51, 51, 51);"></div></div>
                            </div>
                            
                        </div>
                        
                        <div class="col-md-8">

                            <div class="recipient-box"> 
                                <select data-placeholder=" " class="form-control chzn-select chzn-done" multiple="" style="display: none;"> 
                                    <option value="k.mckoy@ztapps.com">Kevin Mckoy</option>
                                    <option value="y.robinson@ztapps.com" selected="">Yanique Robinson</option>
                                    <option value="gavino@ztapps.com">Gavino Free</option> 
                                    <option value="ggeoff@ztapps.com">Geoff Ramsey</option>
                                    <option value="kkara@ztapps.com">Kara Kingsley</option>
                                    <option value="barbs@ztapps.com">Barbara Dundkleman</option> 
                                </select>
                            </div>

                            <!-- new chat page-->

                            <div id="addChatModal" class="modal">
                                <div class="modal-content">
                                    <h2>New Chat</h2>
                                    <input type="text" class="search-box" placeholder="Search contacts...">
                                    <div class="contact-list">
                                        <div class="contact-item">John Doe</div>
                                        <div class="contact-item">Jane Smith</div>
                                        <div class="contact-item">Alice Johnson</div>
                                        <div class="contact-item">Bob Brown</div>
                                        <!-- Add more contacts as needed -->
                                    </div>
                                    <div class="modal-footer">
                                        <button class="cancel-btn" id="cancelBtn">Cancel</button>
                                        <button class="add-btn">Add</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div>

                                <div class="slimScrollDiv" style="position: relative; overflow: hidden; width: auto; height: 452px;">
                                <div class="message-list-wrapper" style="overflow-y: auto; width: auto; height: 452px;">
                                    <ul class="message-list">
                                        <li class="text-center">
                                            <a href="javascript:void(0);" class="btn btn-default">Load More Messages</a>
                                        </li>
                                        <li class="left">
                                            <span class="username">Yanique Robinson</span>
                                            <small class="timestamp">
                                                <i class="fa fa-clock-o"></i>9 mins ago
                                            </small> 
                                            <span class="avatar available tooltips" data-toggle="tooltip " data-placement="right" data-original-title="Yanique Robinson">
                                                <img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt="avatar" class="img-circle">
                                            </span>
                                            <div class="body">   
                                                <div class="message well well-sm">
                                                    Hey, are you busy at the moment?
                                                </div>
                                            </div>
                                        </li>  
                                        <li class="right">
                                            <span class="username">Kevin Mckoy</span>
                                            <small class="timestamp">
                                                <i class="fa fa-clock-o"></i>5 mins ago
                                            </small> 
                                            <span class="avatar tooltips" data-toggle="tooltip " data-placement="left" data-original-title="Kevin Mckoy">
                                                <img src="https://bootdey.com/img/Content/avatar/avatar2.png" alt="avatar" class="img-circle">
                                            </span>
                                            <div class="body">   
                                                <div class="message well well-sm">
                                                    Um, no actually. I've just wrapped up my last project for the day.
                                                </div>
                                                <div class="clearfix"></div>
                                                <div class="message well well-sm">
                                                    Whats up?
                                                </div>
                                            </div>
                                        </li>  
                                        <li class="left">
                                            <span class="username">Yanique Robinson</span>
                                            <small class="timestamp">
                                                <i class="fa fa-clock-o"></i>3 mins ago
                                            </small> 
                                            <span class="avatar available tooltips" data-toggle="tooltip " data-placement="right" data-original-title="Yanique Robinson">
                                                <img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt="avatar" class="img-circle">
                                            </span>
                                            <div class="body">   
                                                <div class="message well well-sm">
                                                    Well, I wanted to find out if you have any plans for tonight.
                                                </div>   
                                                <div class="clearfix"></div>
                                                <div class="message well well-sm">
                                                    <p><a href="#" class="white">Barbara</a> and I are going to this restaurant out of town.</p>
                                                    <img src="https://www.bootdey.com/image/300x200" alt="">
                                                </div>
                                            </div>
                                        </li>  
                                        <li class="right">
                                            <span class="username">Kevin Mckoy</span>
                                            <small class="timestamp">
                                                <i class="fa fa-clock-o"></i>2 mins ago
                                            </small> 
                                            <span class="avatar tooltips" data-toggle="tooltip " data-placement="left" data-original-title="Kevin Mckoy">
                                                <img src="https://bootdey.com/img/Content/avatar/avatar2.png" alt="avatar" class="img-circle">
                                            </span>
                                            <div class="body">   
                                                <div class="message well well-sm">
                                                    Wow that sounds great.
                                                </div>
                                            </div>
                                            </li> 
                                        <li class="left">
                                            <span class="username">Yanique Robinson</span>
                                                <small class="timestamp">
                                                    <i class="fa fa-clock-o"></i>56 secs ago
                                                </small> 
                                            <span class="avatar available tooltips" data-toggle="tooltip " data-placement="right" data-original-title="Yanique Robinson">
                                                    <img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt="avatar" class="img-circle">
                                                </span>
                                                <div class="body">   
                                                    <div class="message well well-sm">
                                                        Ok! We'll swing by your office at 5.
                                                    </div>
                                                </div>
                                            </li>  
                                        <li class="right">
                                            <span class="username">Kevin Mckoy</span>
                                                <small class="timestamp">
                                                    <i class="fa fa-clock-o"></i>3 secs ago
                                                </small> 
                                                <span class="avatar tooltips" data-toggle="tooltip " data-placement="left" data-original-title="Kevin Mckoy">
                                                    <img src="https://bootdey.com/img/Content/avatar/avatar2.png" alt="avatar" class="img-circle">
                                                </span>
                                                <div class="body">   
                                                    <div class="message well well-sm">
                                                        Cool. I'l see you guys then.
                                                    </div>
                                                </div>
                                            </li>   
                                    </ul>
                                </div><div class="slimScrollBar" style="width: 7px; position: absolute; top: 265px; opacity: 0.4; display: none; border-radius: 7px; z-index: 99; right: 1px; height: 187.092px; background: rgb(0, 0, 0);"></div><div class="slimScrollRail" style="width: 7px; height: 100%; position: absolute; top: 0px; display: none; border-radius: 7px; opacity: 0.2; z-index: 90; right: 1px; background: rgb(51, 51, 51);"></div></div>

                                <div class="compose-box">
                                    <div class="row">
                                       <div class="col-xs-12 mg-btm-10">
                                           <textarea id="btn-input" class="form-control input-sm" placeholder="Type your message here..."></textarea>
                                        </div>
                                        <div class="col-xs-8">
                                            <button class="btn btn-green btn-sm">
                                                <i class="fa fa-camera"></i>
                                            </button>
                                            <button class="btn btn-green btn-sm">
                                                <i class="fa fa-video-camera"></i>
                                            </button>
                                            <button class="btn btn-green btn-sm">
                                                <i class="fa fa-file"></i>
                                            </button>
                                        </div>
                                        <div class="col-xs-4"> 
                                            <button class="btn btn-green btn-sm pull-right">
                                                <i class="fa fa-location-arrow"></i> Send
                                            </button>
                                        </div> 
                                    </div> 
                                </div>
                                
                            </div>
                            
                        </div>                                    
                    </div> 
                    
                </div> 
            </div>
        </div>

    </div>
</div>
<script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
<script src="https://netdna.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script type="text/javascript">
	$(function(){
    $(".chat-list-wrapper, .message-list-wrapper").niceScroll();
})
</script>
</body>
</html>

<script>
    const openModalBtn = document.getElementById('openModalBtn');
    const addChatModal = document.getElementById('addChatModal');
    const cancelBtn = document.getElementById('cancelBtn');

    openModalBtn.addEventListener('click', () => {
        addChatModal.style.display = 'flex';
    });

    cancelBtn.addEventListener('click', () => {
        addChatModal.style.display = 'none';
    });

    // Close modal if clicked outside of content
    window.addEventListener('click', (event) => {
        if (event.target === addChatModal) {
            addChatModal.style.display = 'none';
        }
    });
</script>


<script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
<script>
    $(document).ready(() => {
        let socket
        if (!socket || !socket.connected) {
      socket = io('http://localhost:3000', { path: '/chat' });
      
      socket.on('connect', () => {
        console.log('Connected:', socket.id);
      });
    }

      // Listen for the welcome message from the server
      socket.on('welcome', (data) => {
        $('#messages').append(`<p><strong>Server:</strong> ${data.message}</p>`);
      });

      socket.on('receive_message', (data) => {
        $('#messages').append(`<p><strong>${data.user}:</strong> ${data.message}</p>`);
      });

      $('messageBar').on('input', ()=>{
        socket.emit('typing')
      })

      $('#sampleMessage').on('input', function() {

        $('#typingStatus').text('typing..'); 
        socket.emit('typing', {message: 'typing..'})
      });

      socket.on('typing', (data)=>{
        $('#typingStatus').text(data.message);
      })

    
      $('#sendBtn').click(() => {
        const message = $('#sampleMessage').val();
        if (message) {
          const userMessage = { user: 'User1', message }; 
          socket.emit('send_message', userMessage);     
          $('#messages').append(`<p><strong>You:</strong> ${message}</p>`);
          $('#sampleMessage').val(''); 
        }
      });
    });
  </script>
    